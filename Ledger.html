<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Ledger</title>
<style>
body{font-family:system-ui;background:#0b1220;color:#e5e7eb;margin:0}
header{padding:14px;background:#020617;position:sticky;top:0}
.card{background:#111827;border-radius:14px;padding:16px;margin:16px}
.kpis{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
.kpi{background:#020617;padding:12px;border-radius:12px}
label{font-size:12px;color:#9ca3af}
select{width:100%;padding:10px;border-radius:10px;background:#020617;color:#fff}
table{width:100%;border-collapse:collapse}
th,td{padding:8px;border-bottom:1px solid #1f2937;font-size:12px}
</style>
</head>

<body>

<header>
  <b>Ledger</b>
</header>

<div class="card">
  <label>Ledger Type</label>
  <select id="ledgerType">
    <option value="account">ACCOUNT</option>
    <option value="person">PERSON</option>
  </select>

  <label>Ledger Name</label>
  <select id="ledgerName"></select>

  <label>Year</label>
  <select id="ledgerYear">
    <option>2026</option>
    <option>2025</option>
  </select>
</div>

<div class="card">
  <div class="kpis">
    <div class="kpi"><label>Opening</label><div id="k1">–</div></div>
    <div class="kpi"><label>Inflow</label><div id="k2">–</div></div>
    <div class="kpi"><label>Outflow</label><div id="k3">–</div></div>
    <div class="kpi"><label>Closing</label><div id="k4">–</div></div>
  </div>
</div>

<div class="card">
  <table>
    <thead>
      <tr><th>Date</th><th>Description</th><th>Debit</th><th>Credit</th><th>Balance</th></tr>
    </thead>
    <tbody id="rows"></tbody>
  </table>
</div>

<script>
const API = "PASTE_YOUR_NEW_DEPLOYMENT_URL_HERE";

const ledgerType = document.getElementById("ledgerType");
const ledgerName = document.getElementById("ledgerName");
const ledgerYear = document.getElementById("ledgerYear");

ledgerType.onchange = loadNames;
ledgerName.onchange = loadLedger;
ledgerYear.onchange = loadLedger;

function loadNames(){
  fetch(`${API}?mode=ledgers&type=${ledgerType.value}`)
    .then(r=>r.json())
    .then(d=>{
      ledgerName.innerHTML="";
      d.forEach(x=>{
        const o=document.createElement("option");
        o.value=o.textContent=x.name;
        ledgerName.appendChild(o);
      });
      loadLedger();
    });
}

function loadLedger(){
  if(!ledgerName.value) return;

  fetch(`${API}?mode=ledger&type=${ledgerType.value}&name=${ledgerName.value}&year=${ledgerYear.value}`)
    .then(r=>r.json())
    .then(d=>{
      k1.textContent = d.opening_balance;
      k2.textContent = d.total_inflow || d.total_debit;
      k3.textContent = d.total_outflow || d.total_credit;
      k4.textContent = d.closing_balance;

      rows.innerHTML = d.entries.map(e=>`
        <tr>
          <td>${e.date}</td>
          <td>${e.description}</td>
          <td>${e.debit||""}</td>
          <td>${e.credit||""}</td>
          <td>${e.balance}</td>
        </tr>
      `).join("");
    });
}

loadNames();
</script>

</body>
</html>
