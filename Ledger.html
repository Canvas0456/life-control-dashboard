<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Account Ledger</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root {
  --bg1:#F7F8FC; --bg2:#EEF2F7;
  --card:#FFFFFF; --border:#E5E7EB;
  --text:#374151; --muted:#6B7280;
  --debit:#E4989B; --credit:#84A98C;
  --accent:#9AA7D8;
  --radius:14px;
}

body::before {
  content:"";
  position:fixed; inset:0;
  background:
    radial-gradient(circle at 15% 20%, #9AA7D8 0, transparent 35%),
    radial-gradient(circle at 85% 80%, #7FB7A3 0, transparent 40%);
  opacity:.035; pointer-events:none;
}

* { box-sizing:border-box; font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif; }

body {
  margin:0;
  background:linear-gradient(135deg,var(--bg1),var(--bg2));
  color:var(--text);
  min-height:100vh;
  padding:32px 16px 40px;
}

h1 { margin:0 0 20px; }

.card {
  background:var(--card);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:20px;
  margin-bottom:20px;
}

label {
  font-size:13px;
  font-weight:500;
  margin-bottom:6px;
  display:block;
}

select {
  width:100%;
  padding:10px 12px;
  border-radius:8px;
  border:1px solid var(--border);
  font-size:14px;
}

/* SUMMARY CARDS */
.summary {
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:16px;
  margin-bottom:20px;
}

.summary .box {
  background:var(--card);
  border:1px solid var(--border);
  border-radius:14px;
  padding:16px;
}

.summary .label {
  font-size:12px;
  color:var(--muted);
}

.summary .value {
  margin-top:6px;
  font-size:18px;
  font-weight:600;
}

.value.credit { color:var(--credit); }
.value.debit { color:var(--debit); }

table {
  width:100%;
  border-collapse:collapse;
  font-size:13px;
}

thead th {
  text-align:left;
  padding:10px;
  border-bottom:1px solid var(--border);
  color:var(--muted);
  position:sticky;
  top:0;
  background:#FFF;
}

tbody td {
  padding:10px;
  border-bottom:1px dashed var(--border);
}

td.right { text-align:right; }
td.debit { color:var(--debit); }
td.credit { color:var(--credit); }
td.balance { font-weight:600; }

@media(max-width:900px){
  .summary { grid-template-columns:1fr 1fr; }
}

@media(max-width:600px){
  .summary { grid-template-columns:1fr; }
}
</style>
</head>

<body>

<h1>Account Ledger</h1>

<!-- ACCOUNT SELECT -->
<div class="card">
  <label>Select Account</label>
  <select id="accountSelect">
    <option value="">Loading accountsâ€¦</option>
  </select>
</div>

<!-- SUMMARY -->
<div class="summary">
  <div class="box">
    <div class="label">Opening Balance</div>
    <div class="value" id="openBal">â‚¹ 0</div>
  </div>
  <div class="box">
    <div class="label">Net Inflow</div>
    <div class="value credit" id="inflow">â‚¹ 0</div>
  </div>
  <div class="box">
    <div class="label">Net Outflow</div>
    <div class="value debit" id="outflow">â‚¹ 0</div>
  </div>
  <div class="box">
    <div class="label">Closing Balance</div>
    <div class="value" id="closeBal">â‚¹ 0</div>
  </div>
</div>

<!-- LEDGER TABLE -->
<div class="card">
  <table>
    <thead>
      <tr>
        <th>Date</th>
        <th>Txn ID</th>
        <th>Type</th>
        <th>Category</th>
        <th class="right">Debit</th>
        <th class="right">Credit</th>
        <th class="right">Balance</th>
      </tr>
    </thead>
    <tbody id="ledgerBody">
      <tr><td colspan="7"><em>Select an account</em></td></tr>
    </tbody>
  </table>
</div>

<script>
/* ðŸ”´ IMPORTANT â€” PUT YOUR LEDGER WEB APP URL HERE */
const API = "PASTE_LEDGER_WEBAPP_URL_HERE";

const accountSelect = document.getElementById("accountSelect");
const ledgerBody = document.getElementById("ledgerBody");

const openBal = document.getElementById("openBal");
const inflow = document.getElementById("inflow");
const outflow = document.getElementById("outflow");
const closeBal = document.getElementById("closeBal");

/* LOAD ACCOUNTS */
async function loadAccounts() {
  try {
    const accounts = await fetch(API + "?action=accounts").then(r => r.json());
    accountSelect.innerHTML =
      "<option value=''>Select</option>" +
      accounts.map(a => `<option>${a}</option>`).join("");
  } catch {
    accountSelect.innerHTML = "<option>Error loading accounts</option>";
  }
}
loadAccounts();

/* LOAD LEDGER */
accountSelect.onchange = async () => {
  const acc = accountSelect.value;
  if (!acc) return;

  ledgerBody.innerHTML = "<tr><td colspan='7'>Loadingâ€¦</td></tr>";

  const data = await fetch(
    API + "?action=ledger&account=" + encodeURIComponent(acc)
  ).then(r => r.json());

  if (!data.length) {
    ledgerBody.innerHTML = "<tr><td colspan='7'><em>No transactions</em></td></tr>";
    resetSummary();
    return;
  }

  let totalDebit = 0;
  let totalCredit = 0;

  data.forEach(r => {
    totalDebit += Number(r.debit || 0);
    totalCredit += Number(r.credit || 0);
  });

  openBal.textContent = "â‚¹ " + data[0].balance;
  inflow.textContent = "â‚¹ " + totalCredit.toFixed(2);
  outflow.textContent = "â‚¹ " + totalDebit.toFixed(2);
  closeBal.textContent = "â‚¹ " + data[data.length - 1].balance;

  ledgerBody.innerHTML = data.map(r => `
    <tr>
      <td>${r.date}</td>
      <td>${r.txnId}</td>
      <td>${r.type}</td>
      <td>${r.category}</td>
      <td class="right debit">${r.debit ? "â‚¹ " + r.debit : ""}</td>
      <td class="right credit">${r.credit ? "â‚¹ " + r.credit : ""}</td>
      <td class="right balance">â‚¹ ${r.balance}</td>
    </tr>
  `).join("");
};

function resetSummary(){
  openBal.textContent = inflow.textContent =
  outflow.textContent = closeBal.textContent = "â‚¹ 0";
}
</script>

</body>
</html>
