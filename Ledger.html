<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ledger</title>

<style>
body{
  margin:0;
  font-family:system-ui,-apple-system;
  background:#0b1220;
  color:#e5e7eb;
}
header{
  background:#020617;
  padding:14px 18px;
  position:sticky;
  top:0;
}
.card{
  background:#111827;
  border-radius:14px;
  padding:16px;
  margin:16px;
}
label{
  font-size:12px;
  color:#9ca3af;
  display:block;
  margin-top:10px;
}
select{
  width:100%;
  padding:10px;
  margin-top:4px;
  background:#020617;
  color:#fff;
  border:none;
  border-radius:10px;
}
.kpis{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:12px;
}
.kpi{
  background:#020617;
  padding:12px;
  border-radius:12px;
}
.kpi div:last-child{
  font-size:18px;
  font-weight:600;
}
table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  padding:8px;
  font-size:12px;
  border-bottom:1px solid #1f2937;
}
th{
  color:#9ca3af;
}
</style>
</head>

<body>

<header>
  <b>Ledger</b>
</header>

<!-- FILTERS -->
<div class="card">
  <label>Ledger Type</label>
  <select id="ledgerType">
    <option value="account">ACCOUNT</option>
    <option value="person">PERSON</option>
  </select>

  <label>Ledger Name</label>
  <select id="ledgerName"></select>

  <label>Year</label>
  <select id="ledgerYear">
    <option value="2026">2026</option>
    <option value="2025">2025</option>
  </select>
</div>

<!-- KPIs -->
<div class="card">
  <div class="kpis">
    <div class="kpi"><label>Opening</label><div id="k1">â€“</div></div>
    <div class="kpi"><label>Inflow / Debit</label><div id="k2">â€“</div></div>
    <div class="kpi"><label>Outflow / Credit</label><div id="k3">â€“</div></div>
    <div class="kpi"><label>Closing</label><div id="k4">â€“</div></div>
  </div>
</div>

<!-- TABLE -->
<div class="card">
  <table>
    <thead>
      <tr>
        <th>Date</th>
        <th>Description</th>
        <th>Debit</th>
        <th>Credit</th>
        <th>Balance</th>
      </tr>
    </thead>
    <tbody id="rows"></tbody>
  </table>
</div>

<script>
/* ðŸ”´ PASTE YOUR DEPLOYMENT URL HERE */
const API = "PASTE_YOUR_NEW_DEPLOYMENT_URL_HERE";

const ledgerType = document.getElementById("ledgerType");
const ledgerName = document.getElementById("ledgerName");
const ledgerYear = document.getElementById("ledgerYear");

ledgerType.addEventListener("change", loadLedgerNames);
ledgerName.addEventListener("change", loadLedger);
ledgerYear.addEventListener("change", loadLedger);

/* Load ledger names safely */
function loadLedgerNames(){
  ledgerName.innerHTML = "<option>Loading...</option>";

  fetch(`${API}?mode=ledgers&type=${ledgerType.value}`)
    .then(r=>r.json())
    .then(list=>{
      ledgerName.innerHTML = "";

      if(!list || list.length===0){
        ledgerName.innerHTML = "<option>No Ledgers</option>";
        clearUI();
        return;
      }

      list.forEach((l,i)=>{
        const o = document.createElement("option");
        o.value = l.name;
        o.textContent = l.name;
        ledgerName.appendChild(o);
      });

      /* Auto-select first ledger */
      ledgerName.selectedIndex = 0;
      loadLedger();
    })
    .catch(()=>{
      ledgerName.innerHTML = "<option>Error</option>";
    });
}

/* Load ledger data */
function loadLedger(){
  if(!ledgerName.value) return;

  fetch(`${API}?mode=ledger&type=${ledgerType.value}&name=${encodeURIComponent(ledgerName.value)}&year=${ledgerYear.value}`)
    .then(r=>r.json())
    .then(d=>{
      if(!d || !d.entries){
        clearUI();
        return;
      }

      k1.textContent = d.opening_balance ?? "0";
      k2.textContent = d.total_inflow ?? d.total_debit ?? "0";
      k3.textContent = d.total_outflow ?? d.total_credit ?? "0";
      k4.textContent = d.closing_balance ?? "0";

      rows.innerHTML = d.entries.map(e=>`
        <tr>
          <td>${e.date}</td>
          <td>${e.description}</td>
          <td>${e.debit || ""}</td>
          <td>${e.credit || ""}</td>
          <td>${e.balance}</td>
        </tr>
      `).join("");
    });
}

/* Clear UI */
function clearUI(){
  k1.textContent = k2.textContent = k3.textContent = k4.textContent = "â€“";
  rows.innerHTML = "";
}

/* INIT */
loadLedgerNames();
</script>

</body>
</html>
