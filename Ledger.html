<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Account Ledger</title>

<style>
body{margin:0;background:#f5f7fa;font-family:Inter,system-ui;color:#475569}
.container{max-width:1200px;margin:auto;padding:24px}
.card{background:#fff;border:1px solid #e2e8f0;border-radius:16px;padding:20px;margin-bottom:20px}
h1{margin-bottom:16px}
label{font-size:13px;color:#64748b}
select,input{width:100%;padding:12px;border-radius:10px;border:1px solid #e2e8f0}
button{padding:12px 18px;border-radius:10px;border:none;background:#64748b;color:#fff;cursor:pointer}

.filters{
  display:grid;
  grid-template-columns:2fr 1fr 1fr auto;
  gap:16px;
  align-items:end;
}

.stats{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:16px;
}

table{width:100%;border-collapse:collapse}
th,td{padding:10px;border-bottom:1px solid #e2e8f0}
th{color:#64748b}

.loading{color:#94a3b8;text-align:center;padding:20px}

@media(max-width:768px){
  .filters{grid-template-columns:1fr}
  .stats{grid-template-columns:1fr 1fr}
}
</style>
</head>

<body>
<div class="container">

<h1>Account Ledger</h1>

<div class="card filters">
  <div>
    <label>Account</label>
    <select id="account"></select>
  </div>
  <div>
    <label>From Date</label>
    <input type="date" id="from">
  </div>
  <div>
    <label>To Date</label>
    <input type="date" id="to">
  </div>
  <div>
    <button onclick="loadLedger()">Apply</button>
  </div>
</div>

<div class="card stats">
  <div><label>Opening</label><h2 id="opening">₹0</h2></div>
  <div><label>Inflow</label><h2 id="inflow">₹0</h2></div>
  <div><label>Outflow</label><h2 id="outflow">₹0</h2></div>
  <div><label>Closing</label><h2 id="closing">₹0</h2></div>
</div>

<div class="card">
<table>
<thead>
<tr><th>Date</th><th>Txn</th><th>Type</th><th>Category</th><th>Debit</th><th>Credit</th><th>Balance</th></tr>
</thead>
<tbody id="rows">
<tr><td colspan="7" class="loading">Select an account</td></tr>
</tbody>
</table>
</div>

</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbzMO7aNBxJXJ2T7lRN8KQUvy8zmKsDNf_iAe1sfkoloFanBP4a_ui8lOCjxB9lZgRHuag/exec";

const accountEl = document.getElementById("account");
const rowsEl = document.getElementById("rows");

fetch(`${API}?action=accounts`)
  .then(r=>r.json())
  .then(data=>{
    accountEl.innerHTML =
      `<option value="">Select Account</option>` +
      data.map(a=>`<option value="${a.name}">${a.name}</option>`).join("");
    accountEl.addEventListener("change", loadLedger);
  });

function loadLedger(){
  const acc = accountEl.value;
  if(!acc){
    rowsEl.innerHTML = `<tr><td colspan="7" class="loading">Select an account</td></tr>`;
    return;
  }

  rowsEl.innerHTML = `<tr><td colspan="7" class="loading">Loading…</td></tr>`;

  let url = `${API}?action=ledger&account=${encodeURIComponent(acc)}`;
  if(from.value) url += `&from=${from.value}`;
  if(to.value) url += `&to=${to.value}`;

  fetch(url)
    .then(r=>r.json())
    .then(res=>{
      opening.textContent = `₹${res.opening}`;
      inflow.textContent = `₹${res.inflow}`;
      outflow.textContent = `₹${res.outflow}`;
      closing.textContent = `₹${res.closing}`;

      if(!res.rows.length){
        rowsEl.innerHTML = `<tr><td colspan="7" class="loading">No transactions</td></tr>`;
        return;
      }

      rowsEl.innerHTML = res.rows.map(r=>`
        <tr>
          <td>${r.date}</td>
          <td>${r.txn}</td>
          <td>${r.type}</td>
          <td>${r.category}</td>
          <td>${r.debit}</td>
          <td>${r.credit}</td>
          <td>${r.balance}</td>
        </tr>
      `).join("");
    });
}
</script>

</body>
</html>
