<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Ledger</title>

<style>
:root{
  --bg:#0b1220;
  --card:#111827;
  --card-dark:#020617;
  --text:#e5e7eb;
  --muted:#9ca3af;
  --green:#22c55e;
  --red:#ef4444;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system;
  background:var(--bg);
  color:var(--text);
}
header{
  position:sticky;
  top:0;
  background:linear-gradient(180deg,#020617,#020617dd);
  padding:14px 20px;
  z-index:10;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
header b{font-size:18px}

.container{padding:18px;max-width:1100px;margin:auto}

.card{
  background:var(--card);
  border-radius:16px;
  padding:16px;
  margin-bottom:16px;
}

label{
  font-size:12px;
  color:var(--muted);
  margin-top:10px;
  display:block;
}

select{
  width:100%;
  padding:12px;
  margin-top:6px;
  border-radius:12px;
  background:var(--card-dark);
  border:none;
  color:#fff;
  font-size:14px;
  outline:none;
}

.filters{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:14px;
}

.kpis{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:14px;
}
.kpi{
  background:var(--card-dark);
  border-radius:14px;
  padding:14px;
}
.kpi label{margin:0}
.kpi .val{
  font-size:20px;
  margin-top:6px;
  font-weight:600;
}

table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  padding:10px;
  font-size:13px;
  border-bottom:1px solid #1f2937;
}
th{color:var(--muted);text-align:left}

.credit{color:var(--green)}
.debit{color:var(--red)}

.footer{
  text-align:center;
  font-size:11px;
  color:var(--muted);
  margin:20px 0;
}
</style>
</head>

<body>

<header>
  <b>Ledger</b>
  <span id="clock"></span>
</header>

<div class="container">

  <!-- FILTERS -->
  <div class="card filters">
    <div>
      <label>Ledger Type</label>
      <select id="ledgerType">
        <option value="account">ACCOUNT</option>
        <option value="person">PERSON</option>
      </select>
    </div>
    <div>
      <label>Ledger Name</label>
      <select id="ledgerName"></select>
    </div>
    <div>
      <label>Year</label>
      <select id="ledgerYear">
        <option>2026</option>
        <option>2025</option>
      </select>
    </div>
  </div>

  <!-- KPI -->
  <div class="card kpis">
    <div class="kpi"><label>Opening Balance</label><div class="val" id="k_open">–</div></div>
    <div class="kpi"><label>Total Inflow</label><div class="val" id="k_in">–</div></div>
    <div class="kpi"><label>Total Outflow</label><div class="val" id="k_out">–</div></div>
    <div class="kpi"><label>Closing Balance</label><div class="val" id="k_close">–</div></div>
  </div>

  <!-- TABLE -->
  <div class="card">
    <table>
      <thead>
        <tr>
          <th>Date</th>
          <th>Description</th>
          <th>Debit</th>
          <th>Credit</th>
          <th>Balance</th>
        </tr>
      </thead>
      <tbody id="rows"></tbody>
    </table>
  </div>

  <div class="footer">
    Designed & Engineered by Kaiwalya Muley
  </div>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbx0qkMTieJu2dm1sfhd0zvJ8KgKCocfZHNIXyHw6adNjj5cTReMXGO2uKbB_do0PTPLMw/exec";

const ledgerType = document.getElementById("ledgerType");
const ledgerName = document.getElementById("ledgerName");
const ledgerYear = document.getElementById("ledgerYear");

ledgerType.onchange = loadLedgerNames;
ledgerName.onchange = loadLedger;
ledgerYear.onchange = loadLedger;

function loadLedgerNames(){
  ledgerName.innerHTML = "<option>Loading…</option>";
  fetch(`${API}?mode=ledgers&type=${ledgerType.value}`)
    .then(r=>r.json())
    .then(list=>{
      ledgerName.innerHTML="";
      if(!list || list.length===0){
        ledgerName.innerHTML="<option>No Ledgers</option>";
        return;
      }
      list.forEach(l=>{
        const o=document.createElement("option");
        o.value=l.name;
        o.textContent=l.name;
        ledgerName.appendChild(o);
      });
      ledgerName.selectedIndex=0;
      loadLedger();
    });
}

function loadLedger(){
  if(!ledgerName.value) return;
  fetch(`${API}?mode=ledger&type=${ledgerType.value}&name=${encodeURIComponent(ledgerName.value)}&year=${ledgerYear.value}`)
    .then(r=>r.json())
    .then(d=>{
      k_open.textContent = d.opening_balance ?? "0";
      k_in.textContent   = d.total_inflow ?? d.total_credit ?? "0";
      k_out.textContent  = d.total_outflow ?? d.total_debit ?? "0";
      k_close.textContent= d.closing_balance ?? "0";

      rows.innerHTML = (d.entries||[]).map(e=>`
        <tr>
          <td>${e.date}</td>
          <td>${e.description}</td>
          <td class="debit">${e.debit||""}</td>
          <td class="credit">${e.credit||""}</td>
          <td>${e.balance}</td>
        </tr>
      `).join("");
    });
}

/* Clock */
setInterval(()=>{
  clock.textContent = new Date().toLocaleString("en-IN",{weekday:"short",hour:"2-digit",minute:"2-digit",second:"2-digit"});
},1000);

/* INIT */
loadLedgerNames();
</script>

</body>
</html>
