<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Account Ledger</title>

<style>
body{margin:0;font-family:Inter,system-ui;background:#f5f7fa;color:#475569}
.container{max-width:1200px;margin:auto;padding:24px}
.card{background:#fff;border:1px solid #e2e8f0;border-radius:16px;padding:24px;margin-bottom:20px}
h1{margin-bottom:20px}
label{font-size:13px;color:#64748b}
select,input{width:100%;padding:12px;border-radius:10px;border:1px solid #e2e8f0}
button{padding:12px 18px;border-radius:10px;border:none;background:#64748b;color:#fff;cursor:pointer}

.filters{
  display:grid;
  grid-template-columns: 2fr 1fr 1fr 120px;
  gap:16px;
  align-items:end;
}

.stats{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:16px;
}

table{width:100%;border-collapse:collapse}
th,td{padding:10px;border-bottom:1px solid #e2e8f0}
th{color:#64748b}

@media(max-width:768px){
  .filters{grid-template-columns:1fr}
  .stats{grid-template-columns:1fr 1fr}
}
</style>
</head>

<body>
<div class="container">

<h1>Account Ledger</h1>

<div class="card filters">
  <div>
    <label>Account</label>
    <select id="account"></select>
  </div>
  <div>
    <label>From Date</label>
    <input type="date" id="from">
  </div>
  <div>
    <label>To Date</label>
    <input type="date" id="to">
  </div>
  <div>
    <button onclick="loadLedger()">Apply</button>
  </div>
</div>

<div class="card stats">
  <div><label>Opening</label><h2 id="opening">₹0</h2></div>
  <div><label>Inflow</label><h2 id="inflow">₹0</h2></div>
  <div><label>Outflow</label><h2 id="outflow">₹0</h2></div>
  <div><label>Closing</label><h2 id="closing">₹0</h2></div>
</div>

<div class="card">
<table>
<thead>
<tr><th>Date</th><th>Txn</th><th>Type</th><th>Category</th><th>Debit</th><th>Credit</th><th>Balance</th></tr>
</thead>
<tbody id="rows">
<tr><td colspan="7">Select an account</td></tr>
</tbody>
</table>
</div>

</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbzMO7aNBxJXJ2T7lRN8KQUvy8zmKsDNf_iAe1sfkoloFanBP4a_ui8lOCjxB9lZgRHuag/exec";
const account = document.getElementById("account");
const rows = document.getElementById("rows");

fetch(`${API}?action=accounts`)
  .then(r=>r.json())
  .then(data=>{
    account.innerHTML =
      `<option value="">Select</option>` +
      data.map(a=>`<option value="${a}">${a}</option>`).join("");
    account.onchange = loadLedger;
  });

function loadLedger(){
  if(!account.value) return;

  let url = `${API}?action=ledger&account=${account.value}`;
  if(from.value || to.value) url += `&from=${from.value}&to=${to.value}`;

  fetch(url).then(r=>r.json()).then(data=>{
    let inflow=0,outflow=0;

    rows.innerHTML = data.map(r=>{
      inflow+=r.credit; outflow+=r.debit;
      return `<tr>
        <td>${r.date}</td>
        <td>${r.txnId}</td>
        <td>${r.type}</td>
        <td>${r.category}</td>
        <td>${r.debit}</td>
        <td>${r.credit}</td>
        <td>${r.balance}</td>
      </tr>`;
    }).join("");

    opening.textContent = "₹" + (data[0]?.balance - inflow + outflow || 0);
    inflow.textContent = "₹" + inflow;
    outflow.textContent = "₹" + outflow;
    closing.textContent = "₹" + (data.at(-1)?.balance || 0);
  });
}
</script>

</body>
</html>
