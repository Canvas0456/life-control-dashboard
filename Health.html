<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Daily Health Log</title>

<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600&display=swap" rel="stylesheet">

<style>
:root {
  --sage: #9caf88;
  --dusty-rose: #d4a3a3;
  --warm-sand: #f5f2ed;
  --glass: rgba(255, 255, 255, 0.7);
}

* { box-sizing: border-box; }

body, html {
  margin: 0;
  min-height: 100vh;
  font-family: 'Quicksand', sans-serif;
}

.art-bg {
  min-height: 100vh;
  background: linear-gradient(135deg, #fdfcfb 0%, #e2d1c3 100%);
  display: flex;
  justify-content: center;
  padding: 40px 16px;
  position: relative;
}

.shape {
  position: absolute;
  filter: blur(80px);
  z-index: 0;
}
.circle-one {
  width: 400px; height: 400px;
  background: var(--sage);
  top: -10%; left: -10%;
  opacity: 0.3;
}
.circle-two {
  width: 300px; height: 300px;
  background: var(--dusty-rose);
  bottom: 10%; right: -5%;
  opacity: 0.25;
}

/* Live Clock */
.live-time {
  position: fixed;
  top: 14px;
  right: 20px;
  font-size: 0.9rem;
  color: #555;
  z-index: 10;
  background: rgba(255,255,255,0.6);
  padding: 6px 12px;
  border-radius: 12px;
  backdrop-filter: blur(10px);
}

/* Card */
.glass-form {
  width: 100%;
  max-width: 420px;
  background: var(--glass);
  backdrop-filter: blur(15px);
  border-radius: 30px;
  padding: 32px;
  z-index: 1;
  box-shadow: 0 20px 40px rgba(0,0,0,0.08);
}

h1 {
  text-align: center;
  font-weight: 400;
  margin-bottom: 10px;
}

.streak {
  text-align: center;
  margin-bottom: 22px;
  font-size: 0.95rem;
}
.streak span {
  font-size: 1.8rem;
}

/* Inputs */
label {
  margin-top: 16px;
  display: block;
  font-size: 0.85rem;
  color: #666;
}

input, textarea {
  width: 100%;
  padding: 12px;
  border-radius: 14px;
  border: none;
  background: rgba(255,255,255,0.6);
  margin-top: 6px;
  font-family: inherit;
}

textarea { resize: none; }

.grid-2 {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}

/* Button */
.art-button {
  margin-top: 26px;
  width: 100%;
  padding: 15px;
  border: none;
  border-radius: 50px;
  background: var(--sage);
  color: #fff;
  font-size: 1rem;
  letter-spacing: 2px;
  cursor: pointer;
}
.art-button:disabled {
  background: #cfcfcf;
}
</style>
</head>

<body>
<div class="live-time" id="liveTime"></div>

<div class="art-bg">
  <div class="shape circle-one"></div>
  <div class="shape circle-two"></div>

  <form class="glass-form" id="healthForm">
    <h1>Daily Health Log</h1>

    <div class="streak" id="streakBox">
      ðŸ”¥ <span>0</span> Day Streak
    </div>

    <label>Date</label>
    <input type="date" id="entryDate" required />

    <div class="grid-2">
      <div>
        <label>Sleep Time</label>
        <input type="time" id="sleepTime">
      </div>
      <div>
        <label>Wake-up Time</label>
        <input type="time" id="wakeTime">
      </div>
    </div>

    <label>Sleep Hours</label>
    <input type="number" id="sleepHours" readonly>

    <div class="grid-2">
      <div>
        <label>Work Login</label>
        <input type="time" id="workLogin">
      </div>
      <div>
        <label>Work Logout</label>
        <input type="time" id="workLogout">
      </div>
    </div>

    <label>Work Hours</label>
    <input type="number" id="workHours" readonly>

    <label>Screen Time (hours)</label>
    <input type="number" step="0.1" id="screenTime">

    <div class="grid-2">
      <div>
        <label>Steps</label>
        <input type="number" id="steps">
      </div>
      <div>
        <label>Workout (minutes)</label>
        <input type="number" id="workoutMin">
      </div>
    </div>

    <div class="grid-2">
      <div>
        <label>Water Intake (liters)</label>
        <input type="number" step="0.1" id="waterLiters">
      </div>
      <div>
        <label>Weight (kg)</label>
        <input type="number" step="0.1" id="weightKg">
      </div>
    </div>

    <label>Notes</label>
    <textarea rows="3" id="notes"></textarea>

    <button class="art-button" id="saveBtn">SAVE</button>
  </form>
</div>

<script>
/* ================= CONFIG ================= */
const HEALTH_API_URL = "https://script.google.com/macros/s/AKfycbwJZKpjsMiyFG9F022EbeQFVWi-PINF0_zZbVo_WzisNwbQeNQ4mWUQp1oqqyFe_-ra/exec";

/* ================= LIVE TIME ================= */
function updateClock() {
  const now = new Date();
  document.getElementById("liveTime").innerText =
    now.toLocaleDateString(undefined,{weekday:'short',day:'2-digit',month:'short'}) +
    " â€¢ " +
    now.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
}
setInterval(updateClock,1000); updateClock();

/* ================= TIME CALC ================= */
function toMin(t){ if(!t) return null; const [h,m]=t.split(":"); return +h*60 + +m; }

function calcSleep(){
  const s=toMin(sleepTime.value), w=toMin(wakeTime.value);
  if(s==null||w==null) return;
  let d=w-s; if(d<=0)d+=1440;
  sleepHours.value=(d/60).toFixed(2);
}
function calcWork(){
  const i=toMin(workLogin.value), o=toMin(workLogout.value);
  if(i==null||o==null||o<i) return;
  workHours.value=((o-i)/60).toFixed(2);
}
sleepTime.onchange=wakeTime.onchange=calcSleep;
workLogin.onchange=workLogout.onchange=calcWork;

/* ================= STREAK ================= */
fetch(`${HEALTH_API_URL}?action=streak`)
  .then(r=>r.json())
  .then(d=>{
    if(d.streak!==undefined)
      document.querySelector("#streakBox span").innerText=d.streak;
  });

/* ================= SUBMIT ================= */
healthForm.onsubmit = async e => {
  e.preventDefault();
  saveBtn.disabled=true; saveBtn.innerText="SAVING...";

  const payload = {
    entryDate: entryDate.value,
    sleepTime: sleepTime.value,
    wakeTime: wakeTime.value,
    sleepHours: sleepHours.value,
    workLogin: workLogin.value,
    workLogout: workLogout.value,
    workHours: workHours.value,
    screenTime: screenTime.value,
    steps: steps.value,
    workoutMin: workoutMin.value,
    waterLiters: waterLiters.value,
    weightKg: weightKg.value,
    notes: notes.value
  };

  const res = await fetch(HEALTH_API_URL, {
    method: "POST",
    body: JSON.stringify(payload)
  }).then(r=>r.json());

  alert(res.message || "Saved");
  saveBtn.disabled=false; saveBtn.innerText="SAVE";
};
</script>
</body>
</html>
