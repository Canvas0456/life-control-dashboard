<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daily Health Entry</title>

<style>
:root{
  --bg:#f2f7f5;
  --card:#ffffff;
  --primary:#34c759;
  --danger:#ff3b30;
  --muted:#6e6e73;
  --radius:18px;
}
*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI";}
body{margin:0;background:var(--bg);padding:20px;}
.container{max-width:620px;margin:auto;}
.card{
  background:var(--card);
  border-radius:var(--radius);
  padding:22px;
  box-shadow:0 12px 30px rgba(0,0,0,.08);
}
h1{margin:0 0 6px;font-size:22px;}
.sub{font-size:13px;color:var(--muted);margin-bottom:16px;}
label{display:block;margin-top:14px;font-size:13px;color:var(--muted);}
input,select,textarea{
  width:100%;padding:12px;margin-top:6px;
  border-radius:12px;border:1px solid #ddd;font-size:14px;
}
textarea{resize:none}
button{
  width:100%;margin-top:22px;padding:14px;
  border:none;border-radius:14px;
  background:var(--primary);color:#fff;font-size:15px;
}
button:disabled{opacity:.6}
.error{color:var(--danger);font-size:12px;margin-top:8px}
.success{color:#2ecc71;text-align:center;margin-top:12px}

/* ===== Last 10 Table ===== */
.toggle{
  margin-top:22px;
  font-size:14px;
  color:var(--primary);
  cursor:pointer;
  user-select:none;
}
.table-wrap{display:none;margin-top:14px;}
table{width:100%;border-collapse:collapse;font-size:13px;}
th,td{padding:8px;border-bottom:1px solid #eee;text-align:left;}
th{color:var(--muted);font-weight:600}
.badge{
  background:#e8f7ee;
  border-radius:10px;
  padding:2px 8px;
  font-size:11px;
}
</style>
</head>

<body>
<div class="container">
<div class="card">

<h1>Daily Health Check</h1>
<div class="sub">Consistency beats intensity</div>

<label>Date</label>
<input type="date" id="date">

<label>Steps</label>
<input type="number" min="0" id="steps" placeholder="e.g. 6500">

<label>Water Intake (Liters)</label>
<input type="number" step="0.1" min="0" id="water" placeholder="e.g. 3.0">

<label>Sleep (Hours)</label>
<input type="number" step="0.1" min="0" id="sleep" placeholder="e.g. 7.5">

<label>Workout (Minutes)</label>
<input type="number" min="0" id="workout" placeholder="e.g. 45">

<label>Calories Burned (Optional)</label>
<input type="number" min="0" id="calories">

<label>Mood</label>
<select id="mood">
  <option value="">Select</option>
  <option>Excellent</option>
  <option>Good</option>
  <option>Neutral</option>
  <option>Low</option>
  <option>Stressed</option>
</select>

<label>Notes (Optional)</label>
<textarea id="notes" rows="2"></textarea>

<div class="error" id="error"></div>

<!-- IMPORTANT: type="button" -->
<button id="saveBtn" type="button">Save Health Entry</button>

<div class="success" id="success"></div>

<!-- Last 10 Toggle -->
<div class="toggle" id="toggleRecent">Show last 10 health entries âŒ„</div>

<div class="table-wrap" id="recentWrap">
<table>
<thead>
<tr>
  <th>Date</th>
  <th>Steps</th>
  <th>Sleep</th>
  <th>Water</th>
  <th>Mood</th>
</tr>
</thead>
<tbody id="recentBody"></tbody>
</table>
</div>

</div>
</div>

<script>
const API="https://script.google.com/macros/s/AKfycbx0qkMTieJu2dm1sfhd0zvJ8KgKCocfZHNIXyHw6adNjj5cTReMXGO2uKbB_do0PTPLMw/exec";
const $=id=>document.getElementById(id);

/* ===== Init ===== */
$("date").valueAsDate=new Date();
loadRecent();

/* ===== Toggle Table ===== */
$("toggleRecent").onclick=()=>{
  const w=$("recentWrap");
  w.style.display=w.style.display==="none"?"block":"none";
};

/* ===== Save ===== */
$("saveBtn").onclick=async()=>{
  $("error").textContent="";
  $("success").textContent="";
  $("saveBtn").disabled=true;

  if(new Date($("date").value)<new Date("2026-02-01")){
    $("error").textContent="January is locked. Start from Feb-2026.";
    $("saveBtn").disabled=false;
    return;
  }

  const payload={
    type:"health",
    date:$("date").value,
    steps:$("steps").value||0,
    water:$("water").value||0,
    sleep:$("sleep").value||0,
    workout:$("workout").value||0,
    calories:$("calories").value||0,
    mood:$("mood").value,
    notes:$("notes").value
  };

  try{
const r = await fetch(API, {
  method: "POST",
  headers: {
    "Content-Type": "text/plain;charset=utf-8"
  },
  body: JSON.stringify(payload)
}).then(r => r.json());


    if(r.status!=="success"){
      $("error").textContent=r.message;
    }else{
      $("success").textContent="Health entry saved successfully";
      loadRecent();
    }
  }catch(e){
    $("error").textContent="Network error. Try again.";
  }

  $("saveBtn").disabled=false;
};

/* ===== Load Recent ===== */
function loadRecent(){
  fetch(API+"?mode=recent&type=health")
  .then(r=>r.json())
  .then(rows=>{
    $("recentBody").innerHTML=rows.map(r=>`
      <tr>
        <td>${r.date}</td>
        <td>${r.steps}</td>
        <td>${r.sleep}</td>
        <td>${r.water}</td>
        <td><span class="badge">${r.mood||"-"}</span></td>
      </tr>
    `).join("");
  });
}
</script>

</body>
</html>
