<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Daily Money Log</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg:#0F172A;
  --card:#1E293B;
  --accent:#2DD4BF;
  --text:#F8FAFC;
  --muted:#94A3B8;
  --danger:#FB7185;
}

*{box-sizing:border-box}
body{
  margin:0;
  background:radial-gradient(circle at top,#1e293b,#020617);
  font-family:Inter,system-ui;
  color:var(--text);
}

/* Header */
header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:20px 28px;
}
h1{margin:0;font-size:22px;font-weight:600}
#clock{font-size:14px;color:var(--muted)}

/* Layout */
.main{
  display:grid;
  grid-template-columns:420px 1fr;
  gap:24px;
  padding:24px;
}

/* Glass Card */
.card{
  background:rgba(30,41,59,.7);
  backdrop-filter:blur(14px);
  border:1px solid rgba(255,255,255,.08);
  border-radius:18px;
  padding:22px;
  animation:pop .5s ease;
}
@keyframes pop{from{transform:scale(.95);opacity:0}to{transform:scale(1);opacity:1}}

label{
  display:block;
  margin:14px 0 6px;
  font-size:13px;
  color:var(--muted);
}
input,select,textarea{
  width:100%;
  padding:12px;
  border-radius:10px;
  background:#020617;
  border:1px solid rgba(255,255,255,.08);
  color:var(--text);
}
textarea{resize:none}

/* Button */
button{
  width:100%;
  margin-top:18px;
  padding:14px;
  border:none;
  border-radius:999px;
  background:linear-gradient(135deg,var(--accent),#22c55e);
  color:#022c22;
  font-weight:700;
  cursor:pointer;
}

/* Table */
table{width:100%;border-collapse:collapse;font-size:14px}
th,td{padding:12px;border-bottom:1px solid rgba(255,255,255,.06)}
th{text-align:left;color:var(--muted);font-weight:500}

footer{
  text-align:center;
  padding:18px;
  color:#64748B;
  font-size:13px;
}
.hidden{display:none}
</style>
</head>

<body>

<header>
  <h1>ðŸ’¸ Daily Money Log</h1>
  <div id="clock"></div>
</header>

<div class="main">

<!-- FORM -->
<div class="card">
  <label>Date</label>
  <input type="date" id="date">

  <label>Type</label>
  <select id="type">
    <option value="EXP">Expense</option>
    <option value="INC">Income</option>
    <option value="SAV">Savings</option>
    <option value="TRANSFER">Transfer</option>
    <option value="EMI">EMI</option>
  </select>

  <div id="catBox">
    <label>Category</label>
    <select id="category"></select>
  </div>

  <div id="subCatBox">
    <label>Sub Category</label>
    <select id="subCategory"></select>
  </div>

  <label>Amount</label>
  <input type="number" id="amount">

  <div id="fromBox">
    <label>From Account</label>
    <select id="from"></select>
  </div>

  <div id="toBox">
    <label>To Account</label>
    <select id="to"></select>
  </div>

  <div id="emiBox">
    <label>EMI</label>
    <select id="emi"></select>
  </div>

  <label>Notes</label>
  <textarea id="notes" rows="2"></textarea>

  <button onclick="save()">SAVE TRANSACTION</button>
</div>

<!-- LAST 10 -->
<div class="card">
  <h3>Last 10 Transactions</h3>
  <table>
    <thead>
      <tr><th>Date</th><th>Type</th><th>Category</th><th>Accounts</th><th>Amount</th></tr>
    </thead>
    <tbody id="recent"></tbody>
  </table>
</div>

</div>

<footer>
  Â© Designed & Engineered by <b>Kaiwalya Muley</b>
</footer>

<script>
const API="https://script.google.com/macros/s/AKfycbzFrvs7pVyW7HCciqHeNF_1oQVCScJkH_6gem3YXt5lVyxjfJXh36wOXYIRYIho4gGz/exec";
const $=id=>document.getElementById(id);

/* CLOCK */
setInterval(()=>{
  const d=new Date();
  $("clock").innerText=d.toLocaleString("en-IN",{weekday:"long",day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"});
},1000);

/* LOADERS */
async function load(){
  const [a,c,s,e,r]=await Promise.all([
    fetch(API+"?action=accounts").then(r=>r.json()),
    fetch(API+"?action=categories").then(r=>r.json()),
    fetch(API+"?action=subcategories").then(r=>r.json()),
    fetch(API+"?action=emis").then(r=>r.json()),
    fetch(API+"?action=recent").then(r=>r.json())
  ]);

  fill("from",a); fill("to",a);
  fill("category",c);
  subMap=s;
  fill("emi",e.map(x=>`${x.id}|${x.amount}`));

  $("recent").innerHTML=r.map(x=>`
    <tr>
      <td>${x.date}</td>
      <td>${x.type}</td>
      <td>${x.category||""}</td>
      <td>${x.from||""} ${x.to?"â†’ "+x.to:""}</td>
      <td>â‚¹${x.amount}</td>
    </tr>`).join("");
}
let subMap={};

/* HELPERS */
function fill(id,arr){
  $(id).innerHTML="<option></option>"+arr.map(v=>`<option>${v}</option>`).join("");
}

/* TYPE RULES */
$("type").onchange=()=>{
  const t=$("type").value;
  ["catBox","subCatBox","fromBox","toBox","emiBox"].forEach(id=>$(id).classList.add("hidden"));
  $("amount").disabled=false;

  if(t==="EXP"){catBox.hidden=subCatBox.hidden=fromBox.hidden=false}
  if(t==="INC"||t==="SAV"){toBox.hidden=false}
  if(t==="TRANSFER"){fromBox.hidden=toBox.hidden=false}
  if(t==="EMI"){fromBox.hidden=emiBox.hidden=false;$("amount").disabled=true}
};

/* SUBCATS */
$("category").onchange=()=>{
  const c=$("category").value;
  fill("subCategory",subMap[c]||[]);
};

/* EMI AMOUNT */
$("emi").onchange=()=>{
  const v=$("emi").value.split("|");
  $("amount").value=v[1]||"";
};

/* SAVE */
async function save(){
  const payload={
    txnDate:$("date").value,
    txnType:$("type").value,
    category:$("category").value,
    subCategory:$("subCategory").value,
    amount:$("amount").value,
    fromAccount:$("from").value,
    toAccount:$("to").value,
    emiId:$("emi").value.split("|")[0],
    notes:$("notes").value,
    source:"WEB"
  };

  await fetch(API,{
    method:"POST",
    body:JSON.stringify({action:"addTransaction",payload})
  });

  location.reload();
}

load();
</script>

</body>
</html>
