<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Transaction Entry</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Apple-like font -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#f5f5f7;
  --card:rgba(255,255,255,.75);
  --border:rgba(0,0,0,.08);
  --text:#1d1d1f;
  --muted:#6e6e73;
  --accent:#0071e3;
  --success:#34c759;
  --danger:#ff3b30;
  --radius:18px;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:Inter,-apple-system,BlinkMacSystemFont;
  background:var(--bg);
  color:var(--text);
}

.container{
  max-width:480px;
  margin:auto;
  padding:24px 16px 40px;
}

h1{
  font-size:26px;
  font-weight:600;
  margin:0 0 4px;
}

.subtitle{
  color:var(--muted);
  margin-bottom:6px;
}

#commitInfo{
  font-size:12px;
  color:var(--muted);
  margin-bottom:18px;
}

.card{
  background:var(--card);
  backdrop-filter:blur(20px);
  border-radius:var(--radius);
  border:1px solid var(--border);
  padding:20px;
  animation:slideUp .5s ease;
}

@keyframes slideUp{
  from{transform:translateY(12px);opacity:0}
  to{transform:none;opacity:1}
}

.field{margin-bottom:14px}

label{
  font-size:13px;
  color:var(--muted);
  display:block;
  margin-bottom:6px;
}

input,select{
  width:100%;
  padding:12px 14px;
  font-size:15px;
  border-radius:12px;
  border:1px solid var(--border);
  background:#fff;
  outline:none;
  transition:.2s;
}

input:focus,select:focus{
  border-color:var(--accent);
  box-shadow:0 0 0 3px rgba(0,113,227,.15);
}

.inline{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
}

button{
  width:100%;
  padding:14px;
  border-radius:14px;
  border:none;
  font-size:16px;
  font-weight:600;
  background:var(--accent);
  color:#fff;
  cursor:pointer;
  transition:.15s;
}

button:hover{
  transform:translateY(-1px);
  box-shadow:0 6px 18px rgba(0,113,227,.3);
}

.status{
  margin-top:14px;
  text-align:center;
  font-weight:500;
}

.success{color:var(--success)}
.error{color:var(--danger)}
</style>
</head>

<body>
<div class="container">

<h1>Transaction Entry</h1>
<div class="subtitle">Clean â€¢ Controlled â€¢ Real-time</div>
<div id="commitInfo">Loading versionâ€¦</div>

<div class="card">
<form id="txnForm">

<div class="field">
  <label>Date</label>
  <input type="date" id="date" required>
</div>

<div class="inline">
  <div class="field">
    <label>Amount</label>
    <input type="number" id="amount" placeholder="â‚¹" required>
  </div>
  <div class="field">
    <label>Type</label>
    <select id="txnType" required>
      <option value="">Select</option>
      <option>Expense</option>
      <option>Income</option>
      <option>Transfer</option>
    </select>
  </div>
</div>

<div class="field">
  <label>Level-1</label>
  <select id="level1" required></select>
</div>

<div class="field">
  <label>Category</label>
  <select id="category" required></select>
</div>

<div class="field">
  <label>Sub-Category</label>
  <select id="subCategory" required></select>
</div>

<div class="inline">
  <div class="field">
    <label>From Account</label>
    <select id="fromAccount" required></select>
  </div>
  <div class="field">
    <label>To Account</label>
    <select id="toAccount"></select>
  </div>
</div>

<div class="field">
  <label>Description</label>
  <input type="text" id="description" placeholder="Optional note">
</div>

<button type="submit">Save Transaction</button>
<div class="status" id="status"></div>

</form>
</div>
</div>

<script>
/* ================= CONFIG ================= */
const API =
"https://script.google.com/macros/s/AKfycbx0yqBiy_b6vq4J6ddJJo-2-cwQdbTmSJ9BYtOdVIdqZ12-XNi6nfBF4T_msoKgPmNqtg/exec";

/* ðŸ”´ CHANGE THIS */
const GITHUB_USER = "Canvas0456";
const REPO_NAME = "life-control-dashboard";
const FILE_PATH = "transactions.html";

/* ============== DOM BINDINGS ============== */
const level1 = document.getElementById("level1");
const category = document.getElementById("category");
const subCategory = document.getElementById("subCategory");
const fromAccount = document.getElementById("fromAccount");
const toAccount = document.getElementById("toAccount");
const status = document.getElementById("status");
const date = document.getElementById("date");
const amount = document.getElementById("amount");
const txnType = document.getElementById("txnType");
const description = document.getElementById("description");

let dropdowns = {};

/* ============== AUTO DATE ============== */
date.valueAsDate = new Date();

/* ============== LOAD DROPDOWNS ============== */
async function loadDropdowns(){
  const res = await fetch(API + "?mode=dropdowns");
  dropdowns = await res.json();

  level1.innerHTML = `<option value="">Select</option>`;
  dropdowns.level1.forEach(v=>{
    level1.innerHTML += `<option value="${v}">${v}</option>`;
  });

  fromAccount.innerHTML = `<option value="">Select</option>`;
  toAccount.innerHTML = `<option value="">Optional</option>`;
  dropdowns.accounts.forEach(a=>{
    fromAccount.innerHTML += `<option value="${a}">${a}</option>`;
    toAccount.innerHTML += `<option value="${a}">${a}</option>`;
  });
}

level1.onchange = ()=>{
  category.innerHTML = `<option value="">Select</option>`;
  subCategory.innerHTML = `<option value="">Select</option>`;
  const cats = dropdowns.categories[level1.value] || {};
  Object.keys(cats).forEach(c=>{
    category.innerHTML += `<option value="${c}">${c}</option>`;
  });
};

category.onchange = ()=>{
  subCategory.innerHTML = `<option value="">Select</option>`;
  (dropdowns.categories[level1.value][category.value] || [])
    .forEach(s=>{
      subCategory.innerHTML += `<option value="${s}">${s}</option>`;
    });
};

/* ============== SUBMIT ============== */
document.getElementById("txnForm").onsubmit = async e=>{
  e.preventDefault();
  status.textContent = "Savingâ€¦";
  status.className = "status";

  const payload = {
    type:"transaction",
    date:date.value,
    amount:amount.value,
    txnType:txnType.value,
    level1:level1.value,
    category:category.value,
    subCategory:subCategory.value,
    fromAccount:fromAccount.value,
    toAccount:toAccount.value,
    description:description.value
  };

  const res = await fetch(API,{
    method:"POST",
    body:JSON.stringify(payload)
  }).then(r=>r.json());

  status.textContent = res.message;
  status.className = "status " + (res.status==="success"?"success":"error");

  if(res.status==="success"){
    document.getElementById("txnForm").reset();
    date.valueAsDate = new Date();
  }
};

/* ============== GITHUB COMMIT TIMESTAMP ============== */
async function loadCommitInfo(){
  try{
    const url =
      `https://api.github.com/repos/${GITHUB_USER}/${REPO_NAME}/commits?path=${FILE_PATH}&per_page=1`;
    const res = await fetch(url);
    const data = await res.json();
    if(!data[0]) throw "";
    const d = new Date(data[0].commit.committer.date);
    document.getElementById("commitInfo").textContent =
      "Last Updated: " + d.toLocaleString();
  }catch{
    document.getElementById("commitInfo").textContent =
      "Version info unavailable";
  }
}

/* ============== INIT ============== */
loadDropdowns();
loadCommitInfo();
</script>

</body>
</html>
