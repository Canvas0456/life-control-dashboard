<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Transaction Entry · Kaiwalya Muley</title>

<style>
/* ================= THEME ================= */
:root{
  --bg:#0b1220;
  --glass:rgba(255,255,255,.06);
  --border:rgba(255,255,255,.14);
  --text:#e5e7eb;
  --muted:#9ca3af;
  --accent:#4ade80;
  --danger:#ef4444;
  --radius:18px;
  --blur:blur(18px);
}

*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto}

body{
  margin:0;
  min-height:100vh;
  background:
    radial-gradient(900px 400px at 10% -10%,#1e293b,transparent),
    radial-gradient(700px 350px at 90% 10%,#020617,transparent),
    var(--bg);
  color:var(--text);
}

/* ================= HEADER ================= */
header{
  position:sticky;top:0;z-index:10;
  backdrop-filter:var(--blur);
  background:linear-gradient(180deg,rgba(2,6,23,.9),rgba(2,6,23,.7));
  border-bottom:1px solid var(--border);
}
.header-wrap{
  max-width:760px;
  margin:auto;
  padding:14px 18px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.title{font-size:18px;font-weight:600}
.subtitle{font-size:11px;color:var(--muted)}
.live{font-size:12px;color:var(--muted);text-align:right}

/* ================= CARD ================= */
.container{max-width:760px;margin:22px auto;padding:0 14px}
.card{
  background:var(--glass);
  backdrop-filter:var(--blur);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:22px;
  animation:fadeUp .6s ease;
}
@keyframes fadeUp{
  from{opacity:0;transform:translateY(14px)}
  to{opacity:1;transform:none}
}

/* ================= FORM ================= */
label{
  font-size:12px;
  color:var(--muted);
  margin-top:16px;
  display:block;
}

input, textarea{
  width:100%;
  margin-top:6px;
  padding:14px;
  border-radius:16px;
  border:1px solid var(--border);
  background:rgba(2,6,23,.75);
  color:var(--text);
  transition:.25s;
}
input:focus, textarea:focus{
  outline:none;
  border-color:var(--accent);
  box-shadow:0 0 0 2px rgba(74,222,128,.18);
}
textarea{resize:none}

/* ================= MODERN SELECT ================= */
.select-wrap{
  position:relative;
  margin-top:6px;
}
.select-wrap select{
  appearance:none;
  width:100%;
  padding:14px 46px 14px 14px;
  border-radius:16px;
  border:1px solid var(--border);
  background:
    linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02)),
    rgba(2,6,23,.75);
  color:var(--text);
  font-size:14px;
  cursor:pointer;
  transition:.25s;
}
.select-wrap select:hover{
  border-color:rgba(255,255,255,.3);
}
.select-wrap select:focus{
  outline:none;
  border-color:var(--accent);
  box-shadow:
    0 0 0 2px rgba(74,222,128,.18),
    inset 0 0 0 1px rgba(74,222,128,.25);
}
.select-wrap::after{
  content:"▾";
  position:absolute;
  right:16px;
  top:50%;
  transform:translateY(-50%);
  color:var(--muted);
  pointer-events:none;
  transition:.25s;
}
.select-wrap:focus-within::after{
  color:var(--accent);
  transform:translateY(-50%) rotate(180deg);
}

/* ================= BUTTONS ================= */
button{
  width:100%;
  margin-top:22px;
  padding:15px;
  border-radius:18px;
  border:none;
  font-weight:600;
  cursor:pointer;
  transition:.25s;
}
.primary{
  background:linear-gradient(135deg,#22c55e,#4ade80);
  color:#052e16;
}
.primary:disabled{opacity:.6}
.secondary{
  background:rgba(255,255,255,.06);
  color:var(--text);
  border:1px solid var(--border);
}

.hidden{display:none}
.msg{text-align:center;font-size:13px;margin-top:10px}
.error{color:var(--danger)}
.success{color:var(--accent)}

table{width:100%;border-collapse:collapse;margin-top:12px}
th,td{
  padding:10px;
  font-size:12px;
  border-bottom:1px solid var(--border);
}
th{color:var(--muted);text-align:left}

.footer{
  margin-top:18px;
  text-align:center;
  font-size:11px;
  color:var(--muted);
}
</style>
</head>

<body>

<header>
  <div class="header-wrap">
    <div>
      <div class="title">New Transaction</div>
      <div class="subtitle">Designed by Kaiwalya Muley</div>
    </div>
    <div class="live" id="liveClock"></div>
  </div>
</header>

<div class="container">
<div class="card">

<label>Date</label>
<input type="date" id="date">

<label>Transaction Type</label>
<div class="select-wrap">
  <select id="txnType">
    <option value="">Select</option>
    <option>Income</option>
    <option>Expense</option>
    <option>Transfer</option>
  </select>
</div>

<label>Level-1</label>
<div class="select-wrap">
  <select id="level1"></select>
</div>

<div id="catWrap" class="hidden">
  <label>Category</label>
  <div class="select-wrap"><select id="category"></select></div>

  <label>Sub-Category</label>
  <div class="select-wrap"><select id="subCategory"></select></div>
</div>

<label>Amount</label>
<input type="number" id="amount">

<div id="fromWrap" class="hidden">
  <label>From Account</label>
  <div class="select-wrap"><select id="fromAccount"></select></div>
</div>

<div id="toWrap" class="hidden">
  <label>To Account</label>
  <div class="select-wrap"><select id="toAccount"></select></div>
</div>

<div id="personWrap" class="hidden">
  <label>Related Person</label>
  <div class="select-wrap"><select id="relatedPerson"></select></div>

  <label>Other Person (optional)</label>
  <input type="text" id="otherPerson" placeholder="Enter name">
</div>

<label>Notes</label>
<textarea id="notes" rows="2"></textarea>

<div class="msg error" id="error"></div>
<div class="msg success" id="success"></div>

<button class="primary" id="saveBtn">Save Transaction</button>

<button class="secondary" id="toggleRecent">Show Last 10 Transactions</button>
<div id="recentWrap" class="hidden">
  <table>
    <thead><tr><th>Date</th><th>Type</th><th>Category</th><th>Amount</th></tr></thead>
    <tbody id="recentBody"></tbody>
  </table>
</div>

<div class="footer">Ledger-Driven Personal Finance System</div>

</div>
</div>

<script>
const API="https://script.google.com/macros/s/AKfycbx0qkMTieJu2dm1sfhd0zvJ8KgKCocfZHNIXyHw6adNjj5cTReMXGO2uKbB_do0PTPLMw/exec";
const $=id=>document.getElementById(id);
date.valueAsDate=new Date();

/* Live Clock */
setInterval(()=>{
  const d=new Date();
  liveClock.textContent=
    d.toLocaleDateString("en-GB",{weekday:"short",day:"2-digit",month:"short",year:"numeric"})
    +" · "+d.toLocaleTimeString();
},1000);

let DATA={},submitting=false;

fetch(API+"?mode=dropdowns").then(r=>r.json()).then(d=>{
  DATA=d;
  fill(fromAccount,d.accounts,true);
  fill(toAccount,d.accounts,true);
});

function fill(sel,arr,blank){
  sel.innerHTML=blank?"<option value=''>Select</option>":"";
  arr.forEach(v=>{
    const o=document.createElement("option");
    o.value=o.textContent=v;
    sel.appendChild(o);
  });
}
function hide(...e){e.forEach(x=>x.classList.add("hidden"))}
function show(...e){e.forEach(x=>x.classList.remove("hidden"))}
function resetCats(){category.innerHTML=subCategory.innerHTML="<option value=''>Select</option>"}
function level1ByType(t){
  return {
    Income:["Income","Receivable"],
    Expense:["Variable","Savings","Sinking","Payable","EMI"],
    Transfer:["Transfer"]
  }[t]||[];
}

/* Logic */
txnType.onchange=()=>{
  hide(catWrap,fromWrap,toWrap,personWrap);
  resetCats();
  fill(level1,level1ByType(txnType.value),true);
  if(txnType.value==="Expense") show(fromWrap);
  if(txnType.value==="Income") show(toWrap);
  if(txnType.value==="Transfer"){
    show(fromWrap,toWrap);
    level1.value="Transfer";
  }
};

level1.onchange=()=>{
  hide(catWrap,personWrap);
  resetCats();relatedPerson.innerHTML="";otherPerson.value="";
  if(level1.value==="Receivable"){
    show(personWrap,toWrap);hide(fromWrap);
    fill(relatedPerson,DATA.receivables||[],true);return;
  }
  if(level1.value==="Payable"){
    show(personWrap,fromWrap);hide(toWrap);
    fill(relatedPerson,DATA.payables||[],true);return;
  }
  if(level1.value==="EMI"){
    show(catWrap,fromWrap);hide(toWrap);
    category.innerHTML="<option>Loan EMI</option>";
    fill(subCategory,DATA.categories.EMI?.["Loan EMI"]||[],true);
    fromAccount.value="HDFC";fromAccount.disabled=true;return;
  }
  show(catWrap);
  fill(category,Object.keys(DATA.categories[level1.value]||{}),true);
};

category.onchange=()=>fill(subCategory,DATA.categories[level1.value]?.[category.value]||[],true);

fromAccount.onchange=()=>{
  if(txnType.value==="Transfer")
    fill(toAccount,DATA.accounts.filter(a=>a!==fromAccount.value),true);
};

saveBtn.onclick=async()=>{
  if(submitting) return;
  submitting=true;saveBtn.disabled=true;error.textContent="";
  const payload={
    type:"transaction",
    date:date.value,
    txnType:txnType.value,
    level1:level1.value,
    category:category.value,
    subCategory:subCategory.value,
    amount:amount.value,
    fromAccount:fromWrap.classList.contains("hidden")?"":fromAccount.value,
    toAccount:toWrap.classList.contains("hidden")?"":toAccount.value,
    relatedTo:relatedPerson.value||otherPerson.value||"",
    notes:notes.value
  };
  const r=await fetch(API,{method:"POST",headers:{"Content-Type":"text/plain"},body:JSON.stringify(payload)}).then(r=>r.json());
  if(r.status!=="success"){error.textContent=r.message;submitting=false;saveBtn.disabled=false;return;}
  success.textContent="Transaction saved";
  setTimeout(()=>location.reload(),900);
};

toggleRecent.onclick=()=>{
  recentWrap.classList.toggle("hidden");
  if(!recentWrap.classList.contains("hidden")){
    fetch(API+"?mode=recent&type=transactions").then(r=>r.json()).then(rows=>{
      recentBody.innerHTML=rows.map(r=>`<tr><td>${r.date}</td><td>${r.type}</td><td>${r.category}</td><td>${r.amount}</td></tr>`).join("");
    });
  }
};
</script>

</body>
</html>
